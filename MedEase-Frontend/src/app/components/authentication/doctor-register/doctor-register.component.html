<div class="container d-flex justify-content-center align-items-center">
    <div class="h-75 border-2 p-3 d-flex flex-column justify-content-center" style="width: 50vw;">
      <div class="d-flex justify-content-center">
        <span class="h3 m-5">Join us</span>
      </div>
      <form [formGroup]="userRegisterForm" enctype="multipart/form-data">
        <div class="row">
          <div class="form-group col-md-6">
            <label for="firstName">First Name</label>
            <input type="text" formControlName="firstName" class="form-control" placeholder="John" />
            <div *ngIf="userRegisterForm.get('firstName')?.errors && userRegisterForm.get('firstName')?.touched">
              <p *ngIf="userRegisterForm.get('firstName')?.getError('required')" class="alert alert-danger py-1">First name is required</p>
              <p *ngIf="userRegisterForm.get('firstName')?.getError('minlength')" class="alert alert-danger py-1">First name minimum length is 3 characters</p>
              <p *ngIf="userRegisterForm.get('firstName')?.getError('maxlength')" class="alert alert-danger py-1">First name maximum length is 30 characters</p>
            </div>
          </div>
          <div class="form-group col-md-6">
            <label for="lastName">Last Name</label>
            <input type="text" formControlName="lastName" class="form-control" placeholder="Doe">
            <div *ngIf="userRegisterForm.get('lastName')?.errors && userRegisterForm.get('lastName')?.touched">
              <p *ngIf="userRegisterForm.get('lastName')?.getError('required')" class="alert alert-danger py-1">Last name is required</p>
              <p *ngIf="userRegisterForm.get('lastName')?.getError('minlength')" class="alert alert-danger py-1">Last name minimum length is 3 characters</p>
              <p *ngIf="userRegisterForm.get('lastName')?.getError('maxlength')" class="alert alert-danger py-1">Last name maximum length is 30 characters</p>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" formControlName="email" class="form-control" placeholder="example@example.com">
          <div *ngIf="userRegisterForm.get('email')?.errors && userRegisterForm.get('email')?.touched">
            <p *ngIf="userRegisterForm.get('email')?.getError('required')" class="alert alert-danger py-1">Email is required</p>
            <p *ngIf="userRegisterForm.get('email')?.getError('email')" class="alert alert-danger py-1">Invalid email format</p>
          </div>
        </div>
        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" class="form-control" id="password" formControlName="password" placeholder="Enter password">
            <div *ngIf="userRegisterForm.get('password')?.errors && userRegisterForm.get('password')?.touched">
                <p class="alert alert-danger py-1" *ngIf="userRegisterForm.get('password')?.getError('required')">Password is required</p>
                <p class="alert alert-danger py-1" *ngIf="userRegisterForm.get('password')?.getError('minlength')">Password should be at least 6 characters long</p>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-md-6">
                <label for="ssn">SSN</label>
                <input type="text" formControlName="ssn" class="form-control mb-2" placeholder="Enter your SSN">
                <div *ngIf="userRegisterForm.get('ssn')?.errors && userRegisterForm.get('ssn')?.touched">
                    <p *ngIf="userRegisterForm.get('ssn')?.getError('required')" class="alert alert-danger py-1">SSN is required</p>
                    <p *ngIf="userRegisterForm.get('ssn')?.getError('pattern')" class="alert alert-danger py-1">Please enter a valid SSN</p>
                </div>
            </div>
            <div class="form-group col-md-6">
                <label for="phoneNumber">Phone Number</label>
                <input type="text" formControlName="phoneNumber" class="form-control mb-2" placeholder="Enter your phone number">
                <div *ngIf="userRegisterForm.get('phoneNumber')?.errors && userRegisterForm.get('phoneNumber')?.touched">
                    <p *ngIf="userRegisterForm.get('phoneNumber')?.getError('required')" class="alert alert-danger py-1">Phone number is required</p>
                    <p *ngIf="userRegisterForm.get('phoneNumber')?.getError('pattern')" class="alert alert-danger py-1">Please enter a valid phone number</p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group col-md-6">
                <label for="gender">Gender</label>
                <select formControlName="gender" class="form-control">
                <option value="" disabled selected>Select Gender</option>
                <option value="{{ Gender.Male }}">Male</option>
                <option value="{{ Gender.Female }}">Female</option>
                </select>
                <div *ngIf="userRegisterForm.get('gender')?.errors && userRegisterForm.get('gender')?.touched">
                <p *ngIf="userRegisterForm.get('gender')?.getError('required')" class="alert alert-danger py-1">Gender is required</p>
                </div>
            </div>
            <div class="form-group col-md-6">
                <label for="birthDate">Birth Date</label>
                <input type="date" formControlName="birthDate" class="form-control">
                <div *ngIf="userRegisterForm.get('birthDate')?.errors && userRegisterForm.get('birthDate')?.touched">
                <p *ngIf="userRegisterForm.get('birthDate')?.getError('required')" class="alert alert-danger py-1">Birth Date is required</p>
                </div>
            </div>
          </div>
        <div class="row">
          <div class="form-group col-md-6">
            <label for="licenseImg">License Image</label>
            <div class="custom-file">
              <input type="file" formControlName="licenseImg" class="custom-file-input" id="licenseImg" (change)="onLicenseImgChange($event)">
              <label class="custom-file-label" for="licenseImg">license image</label>
            </div>
            <div *ngIf="userRegisterForm.get('licenseImg')?.errors && userRegisterForm.get('licenseImg')?.touched">
              <p *ngIf="userRegisterForm.get('licenseImg')?.getError('required')" class="alert alert-danger py-1">license image is required</p>
          </div>
          </div>
          <div class="form-group col-md-6">
            <label for="profilePicture">Profile Picture</label>
            <div class="custom-file">
              <input type="file" formControlName="profilePicture" class="custom-file-input" id="profilePicture" (change)="onProfilePictureChange($event)">
              <label class="custom-file-label" for="profilePicture">Profile picture</label>
            </div>
            <div *ngIf="userRegisterForm.get('profilePicture')?.errors && userRegisterForm.get('profilePicture')?.touched">
              <p *ngIf="userRegisterForm.get('profilePicture')?.getError('required')" class="alert alert-danger py-1">Profile picture is required</p>
          </div>
          </div>
        </div>
        <div class="row">
            <div class="form-group col-md-6">
                <label for="building">Building</label>
                <input type="text" formControlName="building" class="form-control" placeholder="Building">
                <div *ngIf="userRegisterForm.get('building')?.errors && userRegisterForm.get('building')?.touched">
                <p *ngIf="userRegisterForm.get('building')?.getError('required')" class="alert alert-danger py-1">Building is required</p>
                </div>
            </div>
            
            <div class="form-group col-md-6">
                <label for="street">Street</label>
                <input type="text" formControlName="street" class="form-control" placeholder="Street">
                <div *ngIf="userRegisterForm.get('street')?.errors && userRegisterForm.get('street')?.touched">
                <p *ngIf="userRegisterForm.get('street')?.getError('required')" class="alert alert-danger py-1">Street is required</p>
                <p *ngIf="userRegisterForm.get('street')?.getError('minlength')" class="alert alert-danger py-1">Street must be at least 2 characters long</p>
                <p *ngIf="userRegisterForm.get('street')?.getError('maxlength')" class="alert alert-danger py-1">Street cannot be more than 50 characters long</p>
                </div>
            </div>
          </div>
          <div class="row">
            <div class="form-group col-md-6">
              <label for="city">City</label>
              <select #citySelect formControlName="city" class="form-control" (change)="onCitySelect(citySelect)">
                <option value="" disabled selected>-- Select City --</option>
                <option *ngFor="let city of cities$ | async" [value]="city">{{ city }}</option>
              </select>
              <div *ngIf="userRegisterForm.get('city')?.errors && userRegisterForm.get('city')?.touched">
                <p *ngIf="userRegisterForm.get('city')?.getError('required')" class="alert alert-danger py-1">City is required</p>
              </div>
            </div>
            <div class="form-group col-md-6">
              <label for="region">Region</label>
              <select #regionSelect formControlName="region" class="form-control" (change)="onRegionSelect(citySelect, regionSelect)">
                <option value="" disabled selected>-- Select Region --</option>
                <option *ngFor="let region of regions$ | async" [value]="region">{{ region }}</option>
              </select>
              <div *ngIf="userRegisterForm.get('region')?.errors && userRegisterForm.get('region')?.touched">
                <p *ngIf="userRegisterForm.get('region')?.getError('required')" class="alert alert-danger py-1">Region is required</p>
              </div>
            </div>
        </div>

        <div class="form-group">
          <div class="form-check">
            <input type="checkbox" id="allowVisa" class="form-check-input" formControlName="allowVisa">
            <label class="form-check-label" for="allowVisa">Allow Visa</label>
          </div>
        </div>

        <div class="form-group">
          <label for="fees">Fees</label>
          <input type="number" id="fees" class="form-control" formControlName="fees">
          <div *ngIf="userRegisterForm.get('fees')?.invalid && (userRegisterForm.get('fees')?.dirty || userRegisterForm.get('fees')?.touched)" class="alert alert-danger">
            <div *ngIf="userRegisterForm.get('fees')?.getError('required')">Fees are required.</div>
            <div *ngIf="userRegisterForm.get('fees')?.getError('min')">Fees must be at least 0.</div>
            <div *ngIf="userRegisterForm.get('fees')?.getError('max')">Fees cannot be more than 10000.</div>
          </div>
        </div>

        <div class="form-group">
          <label for="faculty">University</label>
          <input type="text" id="faculty" class="form-control" formControlName="faculty">
          <div *ngIf="userRegisterForm.get('faculty')?.invalid && (userRegisterForm.get('faculty')?.dirty || userRegisterForm.get('faculty')?.touched)" class="alert alert-danger">
            <div *ngIf="userRegisterForm.get('faculty')?.getError('required')">Faculty is required.</div>
            <div *ngIf="userRegisterForm.get('faculty')?.getError('minlength')">Faculty must be at least 2 characters long.</div>
            <div *ngIf="userRegisterForm.get('faculty')?.getError('maxlength')">Faculty cannot be more than 200 characters long.</div>
          </div>
        </div>

        <div class="form-group">
          <label for="specialityID">Specialty</label>
          <select #specialtySelect id="specialityID" class="form-control" formControlName="specialityID" (change)="onSpecialtySelect(specialtySelect)">
            <option value="">-- Select Specialty --</option>
            <option *ngFor="let speciality of specialties$ | async" [value]="speciality.id">{{ speciality.name }}</option>
          </select>
          <div *ngIf="userRegisterForm.get('specialityID')?.invalid && (userRegisterForm.get('specialityID')?.dirty || userRegisterForm.get('specialityID')?.touched)" class="alert alert-danger">
            <div *ngIf="userRegisterForm.get('specialityID')?.getError('required')">Specialty is required.</div>
          </div>
        </div>

        <div class="form-group">
          <label for="subSpecialities">Subspecialty</label>
          <select id="subSpecialities" class="form-control" formControlName="subSpecialities" multiple>
            <option *ngFor="let subspeciality of subspecialties$ | async" [value]="subspeciality.id">{{ subspeciality.name }}</option>
          </select>
        </div>


        <div class="form-group">
          <label for="insurances">insurances</label>
          <select id="insurances" class="form-control" formControlName="insurances" multiple>
            <option *ngFor="let insurance of insurances" [value]="insurance.id">{{ insurance.company }}</option>
          </select>
        </div>


        <p *ngIf="serverErrorMsg" class="alert alert-danger py-1">{{serverErrorMsg | lowercase}}</p>
        <div class="row">
            <button type="button" [disabled]="userRegisterForm.invalid" class="btn btn-success" (click)="onRegisterFormSubmit()">
                <span *ngIf="!isLoading">Submit</span>
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm"></span>
            </button>
        </div>
        